{% extends "base.html" %}
{% block title %}لوحة التحكم{% endblock %}
{% block content %}
{% load currency %}
<div class="page-header" data-aos="fade-down">
    <h1 class="h3 mb-0">لوحة التحكم</h1>
    <div class="d-none d-md-block text-muted">نظرة عامة</div>
    </div>

<form method="get" class="row g-3 align-items-end mb-3" data-aos="fade-up">
    <div class="col-12 col-md-3">
        <label class="form-label">من تاريخ</label>
        {{ filter_form.date_from }}
    </div>
    <div class="col-12 col-md-3">
        <label class="form-label">إلى تاريخ</label>
        {{ filter_form.date_to }}
    </div>
    <div class="col-12 col-md-6 d-flex gap-2">
        <button type="submit" class="btn btn-primary">تطبيق</button>
        <a href="{% url 'dashboard' %}" class="btn btn-outline-secondary">إعادة تعيين</a>
        <a class="btn btn-outline-success ms-auto" href="{% url 'dashboard_export' %}{% if request.GET %}?{{ request.GET.urlencode }}{% endif %}">تصدير CSV</a>
    </div>
    </form>

<div class="row g-4 mb-4">
    <div class="col-12 col-md-4" data-aos="fade-up">
        <div class="card">
            <div class="card-body">
                <div class="text-muted small">إجمالي الوارد</div>
                <div class="h4 mb-0">{{ total_ingoing|iqd }}</div>
            </div>
        </div>
    </div>
    <div class="col-12 col-md-4" data-aos="fade-up" data-aos-delay="100">
        <div class="card">
            <div class="card-body">
                <div class="text-muted small">إجمالي الصادر</div>
                <div class="h4 mb-0">{{ total_outgoing|iqd }}</div>
            </div>
        </div>
    </div>
    <div class="col-12 col-md-4" data-aos="fade-up" data-aos-delay="200">
        <div class="card">
            <div class="card-body">
                <div class="text-muted small">صافي الربح</div>
                <div class="h4 mb-0">{{ total_profit|iqd }}</div>
            </div>
        </div>
    </div>
    </div>

<div class="row g-4 mb-4">
    <div class="col-12 col-md-3" data-aos="fade-up">
        <div class="card">
            <div class="card-body">
                <div class="text-muted small">عدد العمليات</div>
                <div class="h4 mb-0">{{ num_orders }}</div>
            </div>
        </div>
    </div>
    <div class="col-12 col-md-3" data-aos="fade-up" data-aos-delay="100">
        <div class="card">
            <div class="card-body">
                <div class="text-muted small">عدد الوارد</div>
                <div class="h4 mb-0">{{ num_ingoing }}</div>
            </div>
        </div>
    </div>
    <div class="col-12 col-md-3" data-aos="fade-up" data-aos-delay="200">
        <div class="card">
            <div class="card-body">
                <div class="text-muted small">عدد الصادر</div>
                <div class="h4 mb-0">{{ num_outgoing }}</div>
            </div>
        </div>
    </div>
    <div class="col-12 col-md-3" data-aos="fade-up" data-aos-delay="300">
        <div class="card">
            <div class="card-body">
                <div class="text-muted small">غير محدد</div>
                <div class="h4 mb-0">{{ num_neutral }}</div>
            </div>
        </div>
    </div>
    </div>

<div class="card" data-aos="fade-up">
    <div class="card-header bg-body-tertiary">
        <h2 class="h5 mb-0">توزيع أرباح الشركاء</h2>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-striped table-hover align-middle mb-0">
                <thead>
                    <tr>
                        <th>الشريك</th>
                        <th>المبلغ المنضم</th>
                        <th>النسبة</th>
                        <th>حصة الربح</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in partner_rows %}
                        <tr>
                            <td>{{ row.partner.name }}</td>
                            <td>{{ row.partner.joined_amount|iqd }}</td>
                            <td><span class="badge text-bg-primary">{{ row.partner.percentage }}%</span></td>
                            <td>{{ row.share|iqd }}</td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="4" class="text-center text-muted p-4">لا يوجد شركاء بعد.</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}


